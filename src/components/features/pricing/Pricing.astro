---
import { FALLBACK_PACKAGES } from '~/config/fallback-data';
import { ScrollReveal } from '@common';
import { PricingCard } from './PricingCard';

// Use fallback packages
const packages = FALLBACK_PACKAGES;
console.log('Pricing component - packages loaded:', packages.length);
---

<section id="pricing" class="py-12 sm:py-16 md:py-20 bg-gradient-to-b from-background via-background to-muted/20">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Section header -->
    <ScrollReveal animation="fade-up" class="text-center mb-8 sm:mb-12 md:mb-16 space-y-3 sm:space-y-4">
      <div class="inline-block">
        <span class="text-xs sm:text-sm font-semibold text-primary uppercase tracking-wider">B·∫£ng gi√°</span>
      </div>
      <h2 class="text-3xl sm:text-4xl md:text-5xl font-bold bg-gradient-to-r from-foreground to-foreground/70 bg-clip-text text-transparent px-4">
        G√≥i D·ªãch V·ª• T·ª≠ Vi
      </h2>
      <p class="text-sm sm:text-base md:text-lg text-muted-foreground max-w-3xl mx-auto px-4">
        Kh√°m ph√° v·∫≠n m·ªánh c·ªßa b·∫°n v·ªõi c√°c g√≥i d·ªãch v·ª• t·ª≠ vi chuy√™n nghi·ªáp, ƒë∆∞·ª£c thi·∫øt k·∫ø ri√™ng cho t·ª´ng nhu c·∫ßu.
      </p>
    </ScrollReveal>

    <!-- Pricing cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 md:gap-8 mb-12 sm:mb-16">
      {
        packages.map((pkg, index) => (
          <ScrollReveal animation="fade-up" delay={index * 100}>
            <PricingCard
              client:load
              id={pkg.id}
              name={pkg.name}
              description={pkg.description}
              price={pkg.price}
              originalPrice={pkg.original_price}
              features={pkg.features}
              isFeatured={pkg.is_featured}
              isPopular={pkg.is_popular}
              onSelect={(id, name, price) => {
                // @ts-expect-error: `selectPackage` is a global function.
                window.selectPackage(id, name, price);
              }}
            />
          </ScrollReveal>
        ))
      }
    </div>

    <!-- Features comparison or additional info -->
    <ScrollReveal animation="fade-up" class="mb-8 sm:mb-12">
      <div class="bg-card border border-border rounded-xl sm:rounded-2xl p-6 sm:p-8 md:p-12 shadow-lg">
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 sm:gap-8 text-center">
          <div class="space-y-1 sm:space-y-2">
            <div class="text-2xl sm:text-3xl font-bold text-primary">24h</div>
            <div class="text-xs sm:text-sm text-muted-foreground">Giao b√°o c√°o PDF nhanh ch√≥ng</div>
          </div>
          <div class="space-y-1 sm:space-y-2">
            <div class="text-2xl sm:text-3xl font-bold text-primary">95%</div>
            <div class="text-xs sm:text-sm text-muted-foreground">ƒê·ªô ch√≠nh x√°c cao</div>
          </div>
          <div class="space-y-1 sm:space-y-2">
            <div class="text-2xl sm:text-3xl font-bold text-primary">10,000+</div>
            <div class="text-xs sm:text-sm text-muted-foreground">Kh√°ch h√†ng tin t∆∞·ªüng</div>
          </div>
        </div>
      </div>
    </ScrollReveal>

    <!-- Footer disclaimer -->
    <ScrollReveal animation="fade-up" class="text-center space-y-3 sm:space-y-4 px-4">
      <p class="text-muted-foreground text-xs sm:text-sm">
        T·∫•t c·∫£ gi√° ƒë·ªÅu t√≠nh b·∫±ng VND. Gi√° c√≥ th·ªÉ thay ƒë·ªïi t√πy theo th·ªùi ƒëi·ªÉm.
      </p>
      <div class="flex flex-col sm:flex-row items-center justify-center gap-3 sm:gap-4 text-xs sm:text-sm text-muted-foreground">
        <span class="flex items-center gap-1.5 sm:gap-2">
          ‚ú® Thanh to√°n an to√†n qua PayOS
        </span>
        <span class="hidden sm:block">‚Ä¢</span>
        <span class="flex items-center gap-1.5 sm:gap-2">
          üìÑ Nh·∫≠n b√°o c√°o PDF trong 24h
        </span>
        <span class="hidden sm:block">‚Ä¢</span>
        <span class="flex items-center gap-1.5 sm:gap-2">
          üîí B·∫£o m·∫≠t th√¥ng tin tuy·ªát ƒë·ªëi
        </span>
      </div>
    </ScrollReveal>
  </div>
</section>

<script>
  // Function to handle package selection
  function selectPackage(packageId: string, packageName: string, price: number) {
    // Track package selection
    const gtag = (window as any).gtag;
    if (typeof gtag === 'function') {
      gtag('event', 'select_item', {
        item_id: packageId,
        item_name: packageName,
        item_category: 'service_package',
        value: price / 1000, // Convert to thousands
        currency: 'VND',
      });
    }

    // Show notification that order page has been removed
    alert('T√≠nh nƒÉng ƒë·∫∑t h√†ng t·∫°m th·ªùi kh√¥ng kh·∫£ d·ª•ng. Vui l√≤ng li√™n h·ªá tr·ª±c ti·∫øp ƒë·ªÉ ƒë·∫∑t h√†ng.');
  }

  // Make function available globally
  (window as any).selectPackage = selectPackage;
</script>
